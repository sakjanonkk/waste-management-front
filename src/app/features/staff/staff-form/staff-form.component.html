<div class="staff-form-page">
  <div class="form-content">

    <div class="header-section">
      @if (isView) {
      <h2>ข้อมูลพนักงาน</h2>
      <p>รายละเอียดข้อมูลพนักงาน</p>
      } @else if (isEdit) {
      <h2>แก้ไขข้อมูลพนักงาน</h2>
      <p>แก้ไขรายละเอียดข้อมูลพนักงาน</p>
      } @else {
      <h2>สร้างบัญชีใหม่</h2>
      <p>เพิ่มข้อมูลพนักงานใหม่เข้าสู่ระบบ</p>
      }
    </div>

    <form [formGroup]="form" class="staff-form">

      <div class="avatar-section">
        <div class="avatar-wrapper" [class.readonly]="isView">
          <img [src]="getImageUrl()" alt="avatar" />
          @if (!isView) {
          <label class="upload-btn" matRipple>
            <input type="file" accept="image/*" (change)="onImageFileSelected($event)" />
            <mat-icon>photo_camera</mat-icon>
          </label>
          }
        </div>
        @if (!isView) {
        <p>อัพโหลดรูปประจำตัวพนักงาน</p>
        }
      </div>

      <div class="input-group">

        <!-- Prefix (Hidden in View if preferred, or shown as disabled) -->
        <mat-form-field appearance="outline" [class.readonly-field]="isView">
          <mat-label>คำนำหน้า*</mat-label>
          <input matInput formControlName="prefix" placeholder="คำนำหน้า" />
        </mat-form-field>


        <mat-form-field appearance="outline" [class.readonly-field]="isView">
          <mat-label>ชื่อ*</mat-label>
          <input matInput formControlName="firstname" placeholder="ชื่อ" />
        </mat-form-field>

        <mat-form-field appearance="outline" [class.readonly-field]="isView">
          <mat-label>นามสกุล*</mat-label>
          <input matInput formControlName="lastname" placeholder="นามสกุล" />
        </mat-form-field>

        <mat-form-field appearance="outline" [class.readonly-field]="isView">
          <mat-label>อีเมล*</mat-label>
          <input matInput formControlName="email" placeholder="email@mail.com" />
        </mat-form-field>

        <mat-form-field appearance="outline" [class.readonly-field]="isView">
          <mat-label>ตำแหน่ง*</mat-label>
          <mat-select formControlName="role" placeholder="ตำแหน่ง ">
            <mat-option value="DRIVER">พนักงานขับรถ</mat-option>
            <mat-option value="COLLECTOR">พนักงานเก็บขยะ</mat-option>
            <mat-option value="ADMIN">พนักงานวางเเผนเส้นทาง</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline" [class.readonly-field]="isView">
          <mat-label>สถานะ*</mat-label>
          <mat-select formControlName="status" placeholder="สถานะ">
            <mat-option value="ACTIVE">ใช้งาน</mat-option>
            <mat-option value="INACTIVE">ไม่ใช้งาน</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline" [class.readonly-field]="isView">
          <mat-label>เบอร์โทรศัพท์*</mat-label>
          <input matInput formControlName="phone_number" placeholder="xxxxxxxxxx" />
        </mat-form-field>

        <!-- Password Field: Hide in View Mode -->
        @if (!isView) {
        @if (!id || isEdit) {
        <mat-form-field appearance="outline">
          <mat-label>{{ isEdit ? 'เปลี่ยนรหัสผ่าน (ถ้าต้องการ)' : 'รหัสผ่าน*' }}</mat-label>
          <input matInput [type]="hidePassword ? 'password' : 'text'" formControlName="password" />
          <button mat-icon-button matSuffix (click)="hidePassword = !hidePassword" type="button">
            <mat-icon>{{hidePassword ? 'visibility_off' : 'visibility'}}</mat-icon>
          </button>
        </mat-form-field>
        }
        }

      </div>

      <div class="actions-section">
        @if (isView) {
        <div class="view-actions">
          <button mat-stroked-button color="warn" class="action-btn" (click)="delete()" [disabled]="loading()">
            <mat-icon>delete</mat-icon>
            ลบข้อมูล
          </button>
          <button mat-flat-button color="primary" class="action-btn" (click)="goToEdit()" [disabled]="loading()">
            <mat-icon>edit</mat-icon>
            แก้ไขข้อมูล
          </button>
        </div>
        <button mat-button class="back-btn" (click)="cancel()">กลับหน้ารายการ</button>
        } @else {
        <button mat-flat-button class="submit-btn" (click)="submit()" [disabled]="loading()">
          @if (!loading()) { <span>{{ id ? 'บันทึกการแก้ไข' : 'ยืนยันการเพิ่ม' }}</span> }
          @else { <span>กำลังบันทึก...</span> }
        </button>
        <button mat-button class="cancel-btn" (click)="cancel()" [disabled]="loading()">ยกเลิก</button>
        }
      </div>

    </form>
  </div>
</div>