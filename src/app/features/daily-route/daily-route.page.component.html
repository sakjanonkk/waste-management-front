<div class="daily-route-page">
  <!-- Header -->
  <div class="daily-route-header">
    <h1 class="daily-route-title">หน้าแสดงเส้นทางการเก็บขยะประจำวัน</h1>

    <button
      mat-flat-button
      color="primary"
      type="button"
      class="daily-route-generate-button"
      [disabled]="isGenerating"
      (click)="onGenerateToday()"
    >
      @if (isGenerating) {
      <mat-progress-spinner
        diameter="18"
        mode="indeterminate"
      ></mat-progress-spinner>
      <span>กำลังคำนวณ...</span>
      } @else {
      <span>คำนวณเส้นทางวันนี้</span>
      }
    </button>
  </div>

  <!-- Main Layout -->
  <div class="daily-route-layout">
    <!-- Left: Map + summary cards -->
    <div class="daily-route-main">
      <!-- Map card -->
      <mat-card class="daily-route-map-card">
        <div #mapContainer class="daily-route-map"></div>
      </mat-card>

      <!-- Stats cards under the map -->
      <div class="daily-route-main-stats">
        <!-- Waste collection stats -->
        <mat-card class="daily-route-card">
          <h3 class="daily-route-card__title">ปริมาณขยะที่เก็บไปแล้ว</h3>

          <div class="daily-route-waste">
            <!-- Recyclable -->
            <div class="daily-route-waste__row">
              <span class="daily-route-waste__label">ขยะรีไซเคิล</span>
              <div class="daily-route-waste__bar-wrapper">
                <div class="daily-route-waste__bar">
                  <div
                    class="daily-route-waste__bar-fill daily-route-waste__bar-fill--recycle"
                    style="width: 52%"
                  ></div>
                </div>
              </div>
              <span class="daily-route-waste__value">6 ตัน</span>
            </div>

            <!-- General -->
            <div class="daily-route-waste__row">
              <span class="daily-route-waste__label">ขยะทั่วไป</span>
              <div class="daily-route-waste__bar-wrapper">
                <div class="daily-route-waste__bar">
                  <div
                    class="daily-route-waste__bar-fill daily-route-waste__bar-fill--general"
                    style="width: 100%"
                  ></div>
                </div>
              </div>
              <span class="daily-route-waste__value">11.5 ตัน</span>
            </div>
          </div>
        </mat-card>

        <!-- Cost summary -->
        <mat-card class="daily-route-card">
          <h3 class="daily-route-card__title">ค่าใช้จ่าย</h3>

          <div class="daily-route-cost">
            <div class="daily-route-cost__block">
              <div class="daily-route-cost__text">
                <p class="daily-route-cost__label">
                  ค่าใช้จ่ายรวมของทุกเส้นทาง
                </p>
                <p class="daily-route-cost__hint">
                  (น้ำมัน + ค่าเสื่อมสภาพรถทั้งหมด)
                </p>
              </div>
              <p class="daily-route-cost__value">
                {{ totalCost | number : "1.0-2" }} บาท
              </p>
            </div>

            <div
              class="daily-route-cost__block daily-route-cost__block--borderless"
            >
              <p class="daily-route-cost__label">ระยะทางทั้งหมดของทุกเส้นทาง</p>
              <p class="daily-route-cost__value">
                {{ totalDistanceKm | number : "1.0-1" }} กิโลเมตร
              </p>
            </div>
          </div>
        </mat-card>
      </div>
    </div>

    <!-- Right: Collection and Alert cards -->
    <div class="daily-route-side">
      <!-- Collection stats -->
      <mat-card class="daily-route-card">
        <h3 class="daily-route-card__title">จำนวนรถเก็บขยะที่ใช้ในวันนี้</h3>
        <div class="daily-route-card__value-row">
          <span class="daily-route-card__value-main"
            >{{ totalVehicles }}/{{ totalVehiclesAvailable }}</span
          >
          <span class="daily-route-card__value-unit">คัน</span>
        </div>
        <div class="daily-route-card__progress">
          <div class="daily-route-card__progress-bar">
            <div
              class="daily-route-card__progress-fill"
              [style.width.%]="
                totalVehiclesAvailable > 0
                  ? (totalVehicles / totalVehiclesAvailable) * 100
                  : 0
              "
            ></div>
          </div>
          <span class="daily-route-card__progress-label"
            >{{
              totalVehiclesAvailable > 0
                ? ((totalVehicles / totalVehiclesAvailable) * 100
                  | number : "1.0-0")
                : 0
            }}%</span
          >
        </div>
      </mat-card>

      <!-- Alert problems -->
      <mat-card class="daily-route-alert-card">
        <div class="daily-route-alert-card__content">
          <h3 class="daily-route-alert-card__title">แจ้งเตือนปัญหา</h3>
          <p class="daily-route-alert-card__count">0 ปัญหา</p>
        </div>

        <button
          mat-flat-button
          color="warn"
          class="daily-route-alert-card__button"
          type="button"
        >
          รายละเอียดปัญหา
        </button>
      </mat-card>
    </div>
  </div>

  <!-- Table card -->
  <mat-card class="daily-route-table-card">
    <div class="daily-route-table-card__header">
      <h3 class="daily-route-table-card__title">
        รายละเอียดเส้นทางของรถเก็บขยะเเต่ละคัน
      </h3>
    </div>

    <div class="daily-route-table-card__body">
      <div class="daily-route-table-wrapper">
        <table class="daily-route-table">
          <thead>
            <tr>
              <th>ทะเปียนรถ</th>
              <th>ชื่อคนขับ</th>
              <th>ความจุขยะทั่วไป</th>
              <th>ความจุขยะรีไซเคิล</th>
              <th>ระยะทางทั้งหมดวิ่ง</th>
              <th>ค่าน้ำมัน</th>
              <th>รายละเอียด</th>
            </tr>
          </thead>
          <tbody>
            @for (route of routesForTable; track route.id) {
            <tr>
              <td data-label="ทะเบียนรถ">{{ route.id }}</td>
              <td data-label="ชื่อคนขับ">{{ route.driver }}</td>
              <td data-label="ความจุขยะทั่วไป">{{ route.fullCapacity }}</td>
              <td data-label="ความจุขยะรีไซเคิล">{{ route.currentCapacity }}</td>
              <td data-label="ระยะทางทั้งหมดวิ่ง">{{ route.distance }}</td>
              <td data-label="ค่าน้ำมัน">{{ route.cost }}</td>
              <td data-label="รายละเอียด">
                <span class="daily-route-status-chip">
                  ✓ {{ route.status }}
                </span>
              </td>
            </tr>
            }
          </tbody>
        </table>
      </div>
    </div>

    <div class="daily-route-table-card__footer">
      <div class="daily-route-table-card__footer-left">
        Showing {{ currentPage }} to {{ itemsPerPage }} of
        {{ totalItems }} records
      </div>

      <div class="daily-route-table-card__footer-right">
        <div class="daily-route-table-card__page-size">
          <span>Items per page:</span>
          <select>
            <option>3</option>
            <option>5</option>
            <option>10</option>
          </select>
        </div>

        <span class="daily-route-table-card__range">
          {{ currentPage }}-{{ itemsPerPage }} of {{ totalItems }}
        </span>

        <div class="daily-route-table-card__pager-buttons">
          <button type="button" disabled>«</button>
          <button type="button" disabled>‹</button>
          <button type="button" disabled>›</button>
          <button type="button" disabled>»</button>
        </div>
      </div>
    </div>
  </mat-card>
</div>
