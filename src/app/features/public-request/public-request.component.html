<div class="public-request-page">
  <!-- Hero Header -->
  <div class="hero-header">
    <div class="hero-content">
      <mat-icon class="hero-icon">eco</mat-icon>
      <h1>แจ้งปัญหา / ขอจุดเก็บขยะใหม่</h1>
      <p>ร่วมกันทำให้ชุมชนสะอาดและน่าอยู่</p>
    </div>
  </div>

  <div class="content-wrapper">
    <!-- Form Section -->
    <div class="form-section">
      <mat-card class="form-card">
        <mat-card-content>
          <form [formGroup]="requestForm" (ngSubmit)="onSubmit()">
            
            <!-- Request Type -->
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>ประเภทคำร้อง</mat-label>
              <mat-select formControlName="request_type">
                <mat-option value="report_problem">
                  <mat-icon>report_problem</mat-icon>
                  แจ้งปัญหาขยะ
                </mat-option>
                <mat-option value="request_point">
                  <mat-icon>add_location</mat-icon>
                  ขอจุดเก็บขยะใหม่
                </mat-option>
              </mat-select>
            </mat-form-field>

            <!-- Point Name -->
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>ชื่อสถานที่ / จุดที่ต้องการแจ้ง</mat-label>
              <input matInput formControlName="point_name" placeholder="เช่น หน้าตลาดสด, หมู่บ้าน xxx">
              <mat-icon matSuffix>location_on</mat-icon>
            </mat-form-field>

            <!-- Map Section -->
            <div class="map-section">
              <label class="section-label">
                <mat-icon>map</mat-icon>
                เลือกตำแหน่งบนแผนที่
              </label>
              
              <!-- Search Box -->
              <mat-form-field appearance="outline" class="full-width search-field">
                <mat-label>ค้นหาสถานที่</mat-label>
                <input matInput id="place-search-input" placeholder="พิมพ์ชื่อสถานที่ เช่น ตลาดนัด, วัด, โรงเรียน...">
                <mat-icon matSuffix>search</mat-icon>
              </mat-form-field>
              
              <div id="public-request-map" class="map-container"></div>
              <div class="location-display">
                @if (requestForm.get('latitude')?.value) {
                  <div class="coords-badge">
                    <mat-icon>gps_fixed</mat-icon>
                    <span>{{ requestForm.get('latitude')?.value | number:'1.6-6' }}, {{ requestForm.get('longitude')?.value | number:'1.6-6' }}</span>
                  </div>
                  @if (selectedAddress) {
                    <div class="address-text">
                      <mat-icon>home</mat-icon>
                      <span>{{ selectedAddress }}</span>
                    </div>
                  }
                } @else {
                  <p class="helper-text">คลิกบนแผนที่เพื่อเลือกตำแหน่ง หรือใช้ปุ่มดึงตำแหน่งปัจจุบัน</p>
                }
              </div>
              <button mat-stroked-button color="primary" type="button" (click)="getCurrentLocation()" class="location-btn">
                <mat-icon>my_location</mat-icon>
                ดึงตำแหน่งปัจจุบัน
              </button>
            </div>

            <!-- Image Upload -->
            <div class="upload-section">
              <label class="section-label">
                <mat-icon>photo_camera</mat-icon>
                แนบรูปภาพ (ถ้ามี)
              </label>
              
              @if (!imagePreview) {
                <div class="upload-dropzone" (click)="fileInput.click()">
                  <mat-icon class="upload-icon">cloud_upload</mat-icon>
                  <span class="upload-text">คลิกเพื่ออัปโหลดรูปภาพ</span>
                  <span class="upload-hint">PNG, JPG ไม่เกิน 10MB</span>
                </div>
              } @else {
                <div class="image-preview">
                  <img [src]="imagePreview" alt="Preview">
                  <button mat-button color="warn" type="button" (click)="removeImage()">
                    <mat-icon>delete</mat-icon>
                    ลบรูปภาพ
                  </button>
                </div>
              }
              <input #fileInput type="file" (change)="onFileSelected($event)" accept="image/*" hidden>
            </div>

            <!-- Remarks -->
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>รายละเอียดเพิ่มเติม</mat-label>
              <textarea matInput formControlName="remarks" rows="3" placeholder="อธิบายปัญหาหรือรายละเอียดเพิ่มเติม..."></textarea>
            </mat-form-field>

            <!-- Reporter Info -->
            <div class="row-group">
              <mat-form-field appearance="outline">
                <mat-label>ชื่อผู้แจ้ง</mat-label>
                <input matInput formControlName="reporter_name">
                <mat-icon matSuffix>person</mat-icon>
              </mat-form-field>
              <mat-form-field appearance="outline">
                <mat-label>เบอร์โทร / อีเมล</mat-label>
                <input matInput formControlName="reporter_contact" placeholder="สำหรับติดต่อกลับ">
                <mat-icon matSuffix>phone</mat-icon>
              </mat-form-field>
            </div>

            <!-- Submit -->
            <button mat-flat-button color="primary" type="submit" [disabled]="isLoading" class="submit-btn">
              @if (isLoading) {
                <mat-spinner diameter="20"></mat-spinner>
                <span>กำลังส่ง...</span>
              } @else {
                <ng-container>
                  <mat-icon>send</mat-icon>
                  <span>ส่งคำร้อง</span>
                </ng-container>
              }
            </button>

          </form>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Info Section -->
    <div class="info-section">
      <div class="info-card">
        <mat-icon class="info-icon problem">report_problem</mat-icon>
        <h3>แจ้งปัญหาขยะ</h3>
        <p>พบปัญหาขยะล้น ถังเสียหาย หรือไม่มีการเก็บ? แจ้งให้เราทราบเพื่อดำเนินการแก้ไข</p>
      </div>
      <div class="info-card">
        <mat-icon class="info-icon point">add_location</mat-icon>
        <h3>ขอจุดเก็บขยะใหม่</h3>
        <p>ต้องการจุดเก็บขยะในพื้นที่ของคุณ? ส่งคำร้องมาให้เราพิจารณา</p>
      </div>
      <div class="info-card">
        <mat-icon class="info-icon fast">speed</mat-icon>
        <h3>ดำเนินการรวดเร็ว</h3>
        <p>ทีมงานจะพิจารณาและดำเนินการภายใน 1-3 วันทำการ</p>
      </div>
    </div>
  </div>
</div>